var mouseDown=false;var lastMouseX=null;var lastMouseY=null;var xMovement=0;var yMovement=0;var zoomLevel=80;var globeDistance=-250;var EarthRadius=80;function onMenu(){inMenu=true;var a=$("#effect");a.css("opacity","0.9");a.css("filter","alpha(oppacity=90)")}function offMenu(){inMenu=false;var a=$("#effect");a.css("opacity","0.5");a.css("filter","alpha(oppacity=50)")}function handleMouseWheel(d){d.preventDefault();test=d;var b=-75;if(displaySettings.globeView=="3d"||displaySettings.globeView=="ortho"){b=2}zoomLevel=zoomLevel+(-d.deltaY/20);var a=-globeDistance-EarthRadius-b;if(displaySettings.globeView=="ortho"){if(zoomLevel>-5){zoomLevel=-5;if(zoomLevel<(globeDistance*2)){zoomLevel=(globeDistance*2)}}}else{if(zoomLevel>a){zoomLevel=a}if(zoomLevel<(globeDistance*2)){zoomLevel=(globeDistance*2)}}var c=new URI(window.location.href);c.removeSearch("zoom");c.addSearch("zoom",zoomLevel);window.history.replaceState("","",c.search())}function handleMouseDown(a){a.preventDefault();mouseDown=true;if(a.type=="mousedown"){lastMouseX=a.clientX;lastMouseY=a.clientY}else{if(a.type=="touchstart"){var b=a.touches[0]||a.changedTouches[0];lastMouseX=b.pageX;lastMouseY=b.pageY}}}function handleMouseUp(i,A){mouseDown=false;if(!MouseDragging&&document.getElementById("canvas-align").style.display=="block"&&!inMenu){var b=i.getBoundingClientRect();var p=A.clientX-b.left;var o=A.clientY-b.top;var z=gl.viewportWidth/gl.viewportHeight;if(displaySettings.globeView=="ortho"){var m=-1*zoomLevel/(80*2);mat4.ortho(pMatrix,(-z*80)*m,(z*80)*m,(-1*80)*m,(1*80)*m,1000,-1000);mat4.identity(mvMatrix);mat4.translate(mvMatrix,mvMatrix,[xMovement,yMovement,globeDistance+zoomLevel]);mat4.multiply(mvMatrix,mvMatrix,earthRotationMatrix);mat4.rotate(mvMatrix,mvMatrix,degToRad(-90),[1,0,0]);mat4.copy(vMatrix,mvMatrix)}var f=Unproject(p,o,0,gl.viewportWidth,gl.viewportHeight,pMatrix,vMatrix);var c=Unproject(p,o,1,gl.viewportWidth,gl.viewportHeight,pMatrix,vMatrix);var E=vec3.create();E[0]=f[0];E[1]=f[1];E[2]=f[2];var D=vec3.create();D[0]=c[0];D[1]=c[1];D[2]=c[2];var B=[];B.push(f);B.push(c);var u=[];var r=0;while(r<SphereTriangles.length){var h=SphereTriangles[r++];var g=SphereTriangles[r++];var e=SphereTriangles[r++];var a=TriangleIntersection(h,g,e,D,E);if(a.intersects){u.push(a.point)}}var w=10000;var n=vec3.create();for(var d=0;d<u.length;d++){var t=vec3.dist(u[d],D);if(t<w){w=t;n=u[d]}}var w=10000;var C=-1;if(vec3.dist(n,vec3.create())>0){for(var s=0;s<GridBoxData.length;s++){var t=vec3.dist(n,GridBoxData[s].point);if(t<w){w=t;C=s}}}if(C>-1){var q=GridBoxData[C].gridBox;var l=GridBoxData[C].lat;var j=GridBoxData[C].lon;var v=GridBoxData[C].anomaly;LayerSettings.CurrGridBoxId=q;LayerSettings.CurrGridBoxLat=l;LayerSettings.CurrGridBoxLon=j;$("div#divGridLat").text(l);$("div#divGridLon").text(j);$("div#divGridValue").text(v);$("div#divGridLat2").text(l);$("div#divGridLon2").text(j);document.getElementById("gridBoxSize").style.display="block"}else{document.getElementById("gridBoxSize").style.display="none"}}var k=new URI(window.location.href);k.removeSearch("rMatrix");k.removeSearch("rMatrixX");k.removeSearch("rMatrixY");k.removeSearch("xMov");k.removeSearch("yMov");k.addSearch("rMatrix",earthRotationMatrix);k.addSearch("rMatrixX",earthRotationMatrix_x);k.addSearch("rMatrixY",earthRotationMatrix_y);k.addSearch("xMov",xMovement);k.addSearch("yMov",yMovement);window.history.replaceState("","",k.search())}var MouseDragging;function handleMouseMove(b){b.preventDefault();if(mouseDown){if(b.clientX!=lastMouseX&&b.clientY!=lastMouseY){MouseDragging=true}}if(!mouseDown){MouseDragging=false;return}var a=null;var i=null;if(b.type=="mousemove"){a=b.clientX;i=b.clientY}else{if(b.type=="touchmove"){b.preventDefault();var h=b.touches[0]||b.changedTouches[0];a=h.pageX;i=h.pageY}}if(displaySettings.globeView=="3d"||displaySettings.globeView=="ortho"){var c=null;if(zoomLevel<=0){c=10}else{c=(zoomLevel-globeDistance)/10}var f=a-lastMouseX;var g=mat4.create();mat4.identity(g);mat4.rotate(g,g,degToRad(f/c),[0,1,0]);mat4.multiply(earthRotationMatrix_x,g,earthRotationMatrix_x);var e=i-lastMouseY;var d=mat4.create();mat4.identity(d);mat4.rotate(d,d,degToRad(e/c),[1,0,0]);mat4.multiply(earthRotationMatrix_y,d,earthRotationMatrix_y);mat4.multiply(earthRotationMatrix,earthRotationMatrix_y,earthRotationMatrix_x);lastMouseX=a;lastMouseY=i}else{var c=null;if(zoomLevel<=0){c=10}else{c=(zoomLevel)/2}var f=1*(a-lastMouseX)/c;var e=-1*(i-lastMouseY)/c;xMovement=xMovement+f;yMovement=yMovement+e;lastMouseX=a;lastMouseY=i}};