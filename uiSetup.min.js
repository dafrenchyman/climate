$(function(){$("#accordion1").accordion({collapsible:true,heightStyle:"content"});$("#slider_year").slider({min:1851,max:2011,value:2000,slide:function(b,c){$("#year").val(c.value)},change:function(b,c){ChangeYear(c.value)}});$("#year").val($("#slider_year").slider("value"));$("#year").change(function(){$("#slider_year").slider("value",this.value)});$("#animateRadio").buttonset();$("#coastsRadio").buttonset();$("#latLonRadio").buttonset();$("#riversRadio").buttonset();$("#lakesRadio").buttonset();$("#3dGlobeRadio").buttonset();$("#smoothGridRadio").buttonset();$("#bumpMapGridRadio").buttonset();$("#pacificRadio").buttonset();$("#geoLinesRadio").buttonset();$("#minorIslandsRadio").buttonset();$("#TimezonesRadio").buttonset();$("#accordionSize").draggable({containment:"#hud",scroll:false,refreshPositions:true,stop:function(c,b){$("#accordionSize").hover(function(){inMenu=true},function(){inMenu=false})}});function a(){$("#effect").toggle("blind",{},1000)}$("#button").click(function(){a()});$("#datasetMenu").menu({select:function(b,c){alert(c.item.text())}});$("#dialogNoData").dialog({autoOpen:false,show:{effect:"fade",duration:200},hide:{effect:"fade",duration:200}});$("#colormapSelectMenu").selectmenu({change:function(b,c){changeColorMap(c.item.value)}});$("#monthMenu").selectmenu({change:function(b,c){ChangeMonth(c.item.value)}})});function changeBumpMapping(c){var a=GetMenuOption(MenuOptions.BumpMapping,c);if(a.file.length>0){displaySettings.lightingEnabled=true;initTextures(a.file)}else{displaySettings.lightingEnabled=false}var b=new URI(window.location.href);b.removeSearch("bumpMapping");b.addSearch("bumpMapping",c);window.history.replaceState("","",b.search())}function changeLevel(d,a){LayerSettings.Level_ID=d;var b=Levels.Level_ID.indexOf(d);LayerSettings.LevelName=Levels.Name[b];if(!(a===undefined)){a()}var c=new URI(window.location.href);c.removeSearch("level");c.addSearch("level",d);window.history.replaceState("","",c.search())}function ChangeSmoothGridMenu(a){ChangeMenuOption(a,MenuOptions.SmoothGrid,true,function(){var b=new URI(window.location.href);b.removeSearch("smoothGrid");if(a=="true"){displaySettings.smoothGridBoxValues=true;b.addSearch("smoothGrid",true)}else{displaySettings.smoothGridBoxValues=false;b.addSearch("smoothGrid",false)}window.history.replaceState("","",b.search());worldBuffers()})}function GlobeViewSettings(b,a){switch(b){case"3d":displaySettings.globeView="3d";if(a){xMovement=0;yMovement=0;zoomLevel=80}break;case"ortho":displaySettings.globeView="ortho";if(a){xMovement=0;yMovement=0;zoomLevel=-165}break;case"2d":displaySettings.globeView="2d";if(a){mat4.identity(earthRotationMatrix);mat4.identity(earthRotationMatrix_x);mat4.identity(earthRotationMatrix_y);xMovement=0;yMovement=0;zoomLevel=70}break;default:break}}function changeGlobeView(a){GlobeViewSettings(a,true);return ChangeMenuOption(a,MenuOptions.Globe,true,function(){var b=new URI(window.location.href);displaySettings.LakesType=a;b.removeSearch("globe");b.addSearch("globe",a);window.history.replaceState("","",b.search());initBuffers()})}function ChangeCenterMenu(a){ChangeMenuOption(a,MenuOptions.PacificCentered,true,function(){var b=new URI(window.location.href);b.removeSearch("center");if(a=="true"){displaySettings.pacificCenter=true;b.addSearch("center",true)}else{displaySettings.pacificCenter=false;b.addSearch("center",false)}window.history.replaceState("","",b.search());initBuffers()})}function ChangeTimeSeries(b){var a=b.name.replace("timeseries_","");if(b.checked){AddTimeseriesData(LayerSettings,a)}else{RemoveLevelFromTimeSeries(a)}}var MenuOptions={BumpMapping:{values:[{option:"land",file:"images/earth_normalmap_flat_8192x4096.jpg",id:"bumpMapGridRadio1"},{option:"landOcean",file:"images/earth_normalmap_8192x4096.jpg",id:"bumpMapGridRadio2"},{option:"",file:"",id:"bumpMapGridRadio3"}]},Globe:{values:[{option:"3d",file:"",id:"3dGlobeRadio1"},{option:"ortho",file:"",id:"3dGlobeRadio2"},{option:"2d",file:"",id:"3dGlobeRadio3"}]},SmoothGrid:{values:[{option:"true",file:"",id:"smoothGridRadio1"},{option:"false",file:"",id:"smoothGridRadio2"}]},PacificCentered:{values:[{option:"true",file:"",id:"pacificRadio1"},{option:"false",file:"",id:"pacificRadio1"}]},TimeZone:{values:[{option:"true",file:"Coastlines/ne_10m_time_zones.js",id:"Timezones1"},{option:"false",file:"",id:"Timezones2"}]},MinorIslands:{values:[{option:"true",file:"Coastlines/ne_10m_minor_islands_coastline.js",id:"minorIslandsRadio1"},{option:"false",file:"",id:"minorIslandsRadio2"}]},Lakes:{values:[{option:"110m",file:"Coastlines/ne_110m_lakes.js",id:"lakesRadio1"},{option:"50m",file:"Coastlines/ne_50m_lakes.js",id:"lakesRadio2"},{option:"10m",file:"Coastlines/ne_10m_lakes.js",id:"lakesRadio3"},{option:"",file:"",id:"lakesRadio4"}]},Coasts:{values:[{option:"110m",file:"Coastlines/ne_110m_coastline.js",id:"coastsRadio1"},{option:"50m",file:"Coastlines/ne_50m_coastline.js",id:"coastsRadio2"},{option:"10m",file:"Coastlines/ne_10m_coastline.js",id:"coastsRadio3"},{option:"",file:"",id:"coastsRadio4"}]},Rivers:{values:[{option:"110m",file:"Coastlines/ne_110m_rivers_lake_centerlines.js",id:"riversRadio1"},{option:"50m",file:"Coastlines/ne_50m_rivers_lake_centerlines.js",id:"riversRadio2"},{option:"10m",file:"Coastlines/ne_10m_rivers_lake_centerlines.js",id:"riversRadio3"},{option:"",file:"",id:"riversRadio4"}]},GeoLines:{values:[{option:"true",file:"Coastlines/ne_10m_geographic_lines.js",id:"geoLinesRadio1"},{option:"false",file:"",id:"geoLinesRadio2"}]},LatLon:{values:[{option:"true",file:"",id:"latLonRadio1"},{option:"false",file:"",id:"latLonRadio2"}]}};function ChangeMinorIslandsMenu(a){ChangeMenuOption(a,MenuOptions.MinorIslands,true,function(){var b=new URI(window.location.href);if(a=="true"){displaySettings.timeZones=true;b.removeSearch("minorIslands");b.addSearch("minorIslands",true);window.history.replaceState("","",b.search())}else{displaySettings.timeZones=false;b.removeSearch("minorIslands");b.addSearch("minorIslands",false);window.history.replaceState("","",b.search())}lineBuffers()})}function ChangeRiversMenu(a){ChangeMenuOption(a,MenuOptions.Rivers,true,function(){var b=new URI(window.location.href);displaySettings.currRivers=a;b.removeSearch("rivers");b.addSearch("rivers",a);window.history.replaceState("","",b.search());if(a==""){displaySettings.rivers=false}else{displaySettings.rivers=true}lineBuffers()})}function ChangeCoastsMenu(a){ChangeMenuOption(a,MenuOptions.Coasts,true,function(){var b=new URI(window.location.href);displaySettings.CoastsType=a;b.removeSearch("coasts");b.addSearch("coasts",a);window.history.replaceState("","",b.search());if(a==""){displaySettings.coasts=false}else{displaySettings.coasts=true}lineBuffers()})}function ChangeLakesMenu(a){ChangeMenuOption(a,MenuOptions.Lakes,true,function(){var b=new URI(window.location.href);displaySettings.LakesType=a;b.removeSearch("lakes");b.addSearch("lakes",a);window.history.replaceState("","",b.search());if(a==""){displaySettings.lakes=false}else{displaySettings.lakes=true}lineBuffers()})}function ChangeTimeZonesMenu(a){ChangeMenuOption(a,MenuOptions.TimeZone,true,function(){var b=new URI(window.location.href);if(a=="true"){displaySettings.timeZones=true;b.removeSearch("timeZones");b.addSearch("timeZones",true);window.history.replaceState("","",b.search())}else{displaySettings.timeZones=false;b.removeSearch("timeZones");b.addSearch("timeZones",false);window.history.replaceState("","",b.search())}lineBuffers()})}function GetMenuOption(b,c){for(var a=0;a<b.values.length;a++){if(b.values[a].option==c){return b.values[a]}}return null}function ChangeMenuOption(h,d,g,a){var e=new URI(window.location.href);var c=$.Deferred();c.resolve();var f=GetMenuOption(d,h);var b=f.file;if(b.length>0){c=$.getScript(b)}if(g==true){$.when(c).done(function(){a()})}return c}function ChangeGeoLinesMenu(a){ChangeMenuOption(a,MenuOptions.GeoLines,true,function(){var b=new URI(window.location.href);b.removeSearch("geoLines");if(a=="true"){displaySettings.geoLines=true;b.addSearch("geoLines",true)}else{displaySettings.geoLines=false;b.addSearch("geoLines",false)}window.history.replaceState("","",b.search());lineBuffers()})}function ChangeLatLonMenu(a){ChangeMenuOption(a,MenuOptions.LatLon,true,function(){var b=new URI(window.location.href);b.removeSearch("latlon");if(a=="true"){displaySettings.latLons=true;b.addSearch("latlon",true)}else{displaySettings.latLons=false;b.addSearch("latlon",false)}window.history.replaceState("","",b.search());lineBuffers()})}function ChangeAnimate(a){LayerSettings.animate=a;AnimateTime()}function AnimateTime(){var b=$("#monthJump")[0].value;var a=moment(LayerSettings.CurrDate,"YYYY-MM-DD").add(b,"M");var d=moment(LayerSettings.EndDate);var c=moment(LayerSettings.StartDate);if(a.isSameOrBefore(d)&&LayerSettings.animate=="true"&&a.isSameOrAfter(c)){ChangeDate(a.format("YYYY-MM-DD"),function(){LoadSphereData(LayerSettings)});setTimeout(function(){AnimateTime()},5000)}else{LayerSettings.animate=false;return}}function animate(){var b=new Date().getTime();if(lastTime!=0){var a=b-lastTime}lastTime=b}function ChangeColorMap(e,f){var d=e.item.children();displaySettings.currColormapName=d.attr("FullName");var b=ColorMaps.filter(function(g){return g.FullName==displaySettings.currColormapName});displaySettings.functionForColorMap=b[0].Function;f();var a=GetLocationOfColorMap(b[0].FullName);var c=new URI(window.location.href);c.removeSearch("colorMap");c.addSearch("colorMap",a);window.history.replaceState("","",c.search())}function ChangeUpperBoundMenu(a){LayerSettings.maxValue=a;worldBuffers();drawLegend()}function ChangeLowerBoundMenu(a){LayerSettings.minValue=a;worldBuffers();drawLegend()}function ChangeDate(a,d){LayerSettings.CurrDate=a;var b=parseInt(a.substring(0,4));var e=parseInt(a.substring(5,7));$("#slider_year").slider(b);$('#monthMenu option[value="'+a.substring(5,7)+'"]').attr("selected","selected").attr("selected",true);$("#monthMenu").selectmenu("refresh");$("#levelRadio"+LayerSettings.Level_ID).prop("checked",true).button("refresh");$("#year").val(b.toString());if(!(d===undefined)){d()}var c=new URI(window.location.href);c.removeSearch("date");c.addSearch("date",LayerSettings.CurrDate);window.history.replaceState("","",c.search())}function ChangeMonth(b){var c=LayerSettings.CurrDate.substring(0,4);var a=c+"-"+b+"-01";ChangeDate(a,function(){LoadSphereData(LayerSettings)})}function ChangeYear(c){c=padLeft(c,4);var b=LayerSettings.CurrDate.substring(5,7);var a=c+"-"+b+"-01";ChangeDate(a,function(){LoadSphereData(LayerSettings)})}function createCsvFromGriddedData(){var d="data:text/csv;charset=utf-8,";d+="Latitude,Longitude,Value\n";if(RawData.Lat.length>0){for(var a=0;a<RawData.Lat.length;a++){var b=RawData.Lat[a]+","+RawData.Lon[a]+","+RawData.ValueFinal[a];d+=b+"\n"}var e=encodeURI(d);var c=document.createElement("a");c.setAttribute("href",e);c.setAttribute("download",LayerSettings.DatabaseStore+"_GridData_"+LayerSettings.CurrDate+".csv");c.click()}else{$("#dialogNoData").dialog("open")}}function ChangeDatasetMenu(c,d){var b=c.item.children();var a=GetDatasetByStore(b.attr("DatabaseStore"));ChangeDataset(a,d,function(){worldBuffers();if(RawData.Lat.length>0){drawLegend()}})}function ChangeDataset(b,c,a){return ChangeDatasetDate(b,b.StartDate,c,a)}function ChangeDatasetDate(e,d,f,a){LayerSettings.FullName=e.FullName;LayerSettings.CurrDate=d;LayerSettings.StartDate=e.StartDate;LayerSettings.EndDate=e.EndDate;LayerSettings.DatabaseStore=e.DatabaseStore;LayerSettings.Dataset_ID=e.Dataset_ID;LayerSettings.OriginalLocation=e.OriginalLocation;LayerSettings.Level_ID=f;LayerSettings.DataUnits=e.Units;LayerSettings.LevelName=e.DefaultLevel;var g=LayerSettings.StartDate.substring(0,4);var c=LayerSettings.EndDate.substring(0,4);$("#slider_year").slider({min:parseInt(g),max:parseInt(c),value:parseInt(LayerSettings.CurrDate.substring(0,4))});var b=LoadLevelDataMenu(LayerSettings);$.when(b).then(sphereDeferred=LoadSphereDataMenu(LayerSettings,a));$("div#divYearMin").text(g);$("div#divYearMax").text(c);$("div#divTitle").text(LayerSettings.FullName);document.getElementById("gridBoxSize").style.display="none";return $.when(b)};