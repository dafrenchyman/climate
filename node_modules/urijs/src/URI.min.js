/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.18.6
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */
(function(a,b){if(typeof module==="object"&&module.exports){module.exports=b(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains"))}else{if(typeof define==="function"&&define.amd){define(["./punycode","./IPv6","./SecondLevelDomains"],b)}else{a.URI=b(a.punycode,a.IPv6,a.SecondLevelDomains,a)}}}(this,function(c,e,k,y){var r=y&&y.URI;function l(q,E){var D=arguments.length>=1;var p=arguments.length>=2;if(!(this instanceof l)){if(D){if(p){return new l(q,E)}return new l(q)}return new l()}if(q===undefined){if(D){throw new TypeError("undefined is not a valid argument for URI")}if(typeof location!=="undefined"){q=location.href+""}else{q=""}}if(q===null){if(D){throw new TypeError("null is not a valid argument for URI")}}this.href(q);if(E!==undefined){return this.absoluteTo(E)}return this}l.version="1.18.6";var v=l.prototype;var s=Object.prototype.hasOwnProperty;function f(p){return p.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function z(p){if(p===undefined){return"Undefined"}return String(Object.prototype.toString.call(p)).slice(8,-1)}function o(p){return z(p)==="Array"}function n(E,D){var F={};var p,q;if(z(D)==="RegExp"){F=null}else{if(o(D)){for(p=0,q=D.length;p<q;p++){F[D[p]]=true}}else{F[D]=true}}for(p=0,q=E.length;p<q;p++){var G=F&&F[E[p]]!==undefined||!F&&D.test(E[p]);if(G){E.splice(p,1);q--;p--}}return E}function B(F,E){var q,D;if(o(E)){for(q=0,D=E.length;q<D;q++){if(!B(F,E[q])){return false}}return true}var p=z(E);for(q=0,D=F.length;q<D;q++){if(p==="RegExp"){if(typeof F[q]==="string"&&F[q].match(E)){return true}}else{if(F[q]===E){return true}}}return false}function j(E,q){if(!o(E)||!o(q)){return false}if(E.length!==q.length){return false}E.sort();q.sort();for(var D=0,p=E.length;D<p;D++){if(E[D]!==q[D]){return false}}return true}function u(q){var p=/^\/+|\/+$/g;return q.replace(p,"")}l._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:l.duplicateQueryParameters,escapeQuerySpace:l.escapeQuerySpace}};l.duplicateQueryParameters=false;l.escapeQuerySpace=true;l.protocol_expression=/^[a-z][a-z0-9.+-]*$/i;l.idn_expression=/[^a-z0-9\.-]/i;l.punycode_expression=/(xn--)/i;l.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;l.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;l.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig;l.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g};l.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};l.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/;l.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"};l.getDomAttribute=function(p){if(!p||!p.nodeName){return undefined}var q=p.nodeName.toLowerCase();if(q==="input"&&p.type!=="image"){return undefined}return l.domAttributes[q]};function b(p){return escape(p)}function w(p){return encodeURIComponent(p).replace(/[!'()*]/g,b).replace(/\*/g,"%2A")}l.encode=w;l.decode=decodeURIComponent;l.iso8859=function(){l.encode=escape;l.decode=unescape};l.unicode=function(){l.encode=w;l.decode=decodeURIComponent};l.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}};l.encodeQuery=function(p,q){var D=l.encode(p+"");if(q===undefined){q=l.escapeQuerySpace}return q?D.replace(/%20/g,"+"):D};l.decodeQuery=function(p,q){p+="";if(q===undefined){q=l.escapeQuerySpace}try{return l.decode(q?p.replace(/\+/g,"%20"):p)}catch(D){return p}};var h={encode:"encode",decode:"decode"};var i;var m=function(q,p){return function(D){try{return l[p](D+"").replace(l.characters[q][p].expression,function(F){return l.characters[q][p].map[F]})}catch(E){return D}}};for(i in h){l[i+"PathSegment"]=m("pathname",h[i]);l[i+"UrnPathSegment"]=m("urnpath",h[i])}var C=function(p,q,D){return function(F){var I;if(!D){I=l[q]}else{I=function(J){return l[q](l[D](J))}}var E=(F+"").split(p);for(var G=0,H=E.length;G<H;G++){E[G]=I(E[G])}return E.join(p)}};l.decodePath=C("/","decodePathSegment");l.decodeUrnPath=C(":","decodeUrnPathSegment");l.recodePath=C("/","encodePathSegment","decode");l.recodeUrnPath=C(":","encodeUrnPathSegment","decode");l.encodeReserved=m("reserved","encode");l.parse=function(p,q){var D;if(!q){q={}}D=p.indexOf("#");if(D>-1){q.fragment=p.substring(D+1)||null;p=p.substring(0,D)}D=p.indexOf("?");if(D>-1){q.query=p.substring(D+1)||null;p=p.substring(0,D)}if(p.substring(0,2)==="//"){q.protocol=null;p=p.substring(2);p=l.parseAuthority(p,q)}else{D=p.indexOf(":");if(D>-1){q.protocol=p.substring(0,D)||null;if(q.protocol&&!q.protocol.match(l.protocol_expression)){q.protocol=undefined}else{if(p.substring(D+1,D+3)==="//"){p=p.substring(D+3);p=l.parseAuthority(p,q)}else{p=p.substring(D+1);q.urn=true}}}}q.path=p;return q};l.parseHost=function(D,G){D=D.replace(/\\/g,"/");var I=D.indexOf("/");var H;var F;if(I===-1){I=D.length}if(D.charAt(0)==="["){H=D.indexOf("]");G.hostname=D.substring(1,H)||null;G.port=D.substring(H+2,I)||null;if(G.port==="/"){G.port=null}}else{var E=D.indexOf(":");var p=D.indexOf("/");var q=D.indexOf(":",E+1);if(q!==-1&&(p===-1||q<p)){G.hostname=D.substring(0,I)||null;G.port=null}else{F=D.substring(0,I).split(":");G.hostname=F[0]||null;G.port=F[1]||null}}if(G.hostname&&D.substring(I).charAt(0)!=="/"){I++;D="/"+D}return D.substring(I)||"/"};l.parseAuthority=function(p,q){p=l.parseUserinfo(p,q);return l.parseHost(p,q)};l.parseUserinfo=function(q,E){var p=q.indexOf("/");var F=q.lastIndexOf("@",p>-1?p:q.length-1);var D;if(F>-1&&(p===-1||F<p)){D=q.substring(0,F).split(":");E.username=D[0]?l.decode(D[0]):null;D.shift();E.password=D[0]?l.decode(D.join(":")):null;q=q.substring(F+1)}else{E.username=null;E.password=null}return q};l.parseQuery=function(E,F){if(!E){return{}}E=E.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!E){return{}}var G={};var H=E.split("&");var q=H.length;var J,p,I;for(var D=0;D<q;D++){J=H[D].split("=");p=l.decodeQuery(J.shift(),F);I=J.length?l.decodeQuery(J.join("="),F):null;if(s.call(G,p)){if(typeof G[p]==="string"||G[p]===null){G[p]=[G[p]]}G[p].push(I)}else{G[p]=I}}return G};l.build=function(q){var p="";if(q.protocol){p+=q.protocol+":"}if(!q.urn&&(p||q.hostname)){p+="//"}p+=(l.buildAuthority(q)||"");if(typeof q.path==="string"){if(q.path.charAt(0)!=="/"&&typeof q.hostname==="string"){p+="/"}p+=q.path}if(typeof q.query==="string"&&q.query){p+="?"+q.query}if(typeof q.fragment==="string"&&q.fragment){p+="#"+q.fragment}return p};l.buildHost=function(q){var p="";if(!q.hostname){return""}else{if(l.ip6_expression.test(q.hostname)){p+="["+q.hostname+"]"}else{p+=q.hostname}}if(q.port){p+=":"+q.port}return p};l.buildAuthority=function(p){return l.buildUserinfo(p)+l.buildHost(p)};l.buildUserinfo=function(q){var p="";if(q.username){p+=l.encode(q.username)}if(q.password){p+=":"+l.encode(q.password)}if(p){p+="@"}return p};l.buildQuery=function(G,I,E){var D="";var H,q,p,F;for(q in G){if(s.call(G,q)&&q){if(o(G[q])){H={};for(p=0,F=G[q].length;p<F;p++){if(G[q][p]!==undefined&&H[G[q][p]+""]===undefined){D+="&"+l.buildQueryParameter(q,G[q][p],E);if(I!==true){H[G[q][p]+""]=true}}}}else{if(G[q]!==undefined){D+="&"+l.buildQueryParameter(q,G[q],E)}}}}return D.substring(1)};l.buildQueryParameter=function(p,D,q){return l.encodeQuery(p,q)+(D!==null?"="+l.encodeQuery(D,q):"")};l.addQuery=function(E,p,D){if(typeof p==="object"){for(var q in p){if(s.call(p,q)){l.addQuery(E,q,p[q])}}}else{if(typeof p==="string"){if(E[p]===undefined){E[p]=D;return}else{if(typeof E[p]==="string"){E[p]=[E[p]]}}if(!o(D)){D=[D]}E[p]=(E[p]||[]).concat(D)}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}}};l.removeQuery=function(G,p,F){var D,E,q;if(o(p)){for(D=0,E=p.length;D<E;D++){G[p[D]]=undefined}}else{if(z(p)==="RegExp"){for(q in G){if(p.test(q)){G[q]=undefined}}}else{if(typeof p==="object"){for(q in p){if(s.call(p,q)){l.removeQuery(G,q,p[q])}}}else{if(typeof p==="string"){if(F!==undefined){if(z(F)==="RegExp"){if(!o(G[p])&&F.test(G[p])){G[p]=undefined}else{G[p]=n(G[p],F)}}else{if(G[p]===String(F)&&(!o(F)||F.length===1)){G[p]=undefined}else{if(o(G[p])){G[p]=n(G[p],F)}}}}else{G[p]=undefined}}else{throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")}}}}};l.hasQuery=function(G,p,F,E){switch(z(p)){case"String":break;case"RegExp":for(var q in G){if(s.call(G,q)){if(p.test(q)&&(F===undefined||l.hasQuery(G,q,F))){return true}}}return false;case"Object":for(var D in p){if(s.call(p,D)){if(!l.hasQuery(G,D,p[D])){return false}}}return true;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(z(F)){case"Undefined":return p in G;case"Boolean":var I=Boolean(o(G[p])?G[p].length:G[p]);return F===I;case"Function":return !!F(G[p],p,G);case"Array":if(!o(G[p])){return false}var H=E?B:j;return H(G[p],F);case"RegExp":if(!o(G[p])){return Boolean(G[p]&&G[p].match(F))}if(!E){return false}return B(G[p],F);case"Number":F=String(F);case"String":if(!o(G[p])){return G[p]===F}if(!E){return false}return B(G[p],F);default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}};l.joinPaths=function(){var p=[];var D=[];var I=0;for(var F=0;F<arguments.length;F++){var q=new l(arguments[F]);p.push(q);var E=q.segment();for(var G=0;G<E.length;G++){if(typeof E[G]==="string"){D.push(E[G])}if(E[G]){I++}}}if(!D.length||!I){return new l("")}var H=new l("").segment(D);if(p[0].path()===""||p[0].path().slice(0,1)==="/"){H.path("/"+H.path())}return H.normalize()};l.commonPath=function(q,p){var D=Math.min(q.length,p.length);var E;for(E=0;E<D;E++){if(q.charAt(E)!==p.charAt(E)){E--;break}}if(E<1){return q.charAt(0)===p.charAt(0)&&q.charAt(0)==="/"?"/":""}if(q.charAt(E)!=="/"||p.charAt(E)!=="/"){E=q.substring(0,E).lastIndexOf("/")}return q.substring(0,E+1)};l.withinString=function(J,N,R){R||(R={});var E=R.start||l.findUri.start;var L=R.end||l.findUri.end;var Q=R.trim||l.findUri.trim;var G=R.parens||l.findUri.parens;var H=/[a-z0-9-]=["']?$/i;E.lastIndex=0;while(true){var I=E.exec(J);if(!I){break}var q=I.index;if(R.ignoreHtml){var p=J.slice(Math.max(q-3,0),q);if(p&&H.test(p)){continue}}var F=q+J.slice(q).search(L);var M=J.slice(q,F);var K=-1;while(true){var O=G.exec(M);if(!O){break}var D=O.index+O[0].length;K=Math.max(K,D)}if(K>-1){M=M.slice(0,K)+M.slice(K).replace(Q,"")}else{M=M.replace(Q,"")}if(R.ignore&&R.ignore.test(M)){continue}F=q+M.length;var P=N(M,q,F,J);if(P===undefined){E.lastIndex=F;continue}P=String(P);J=J.slice(0,q)+P+J.slice(F);E.lastIndex=q+P.length}E.lastIndex=0;return J};l.ensureValidHostname=function(p){if(p.match(l.invalid_hostname_characters)){if(!c){throw new TypeError('Hostname "'+p+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available')}if(c.toASCII(p).match(l.invalid_hostname_characters)){throw new TypeError('Hostname "'+p+'" contains characters other than [A-Z0-9.-]')}}};l.noConflict=function(p){if(p){var q={URI:this.noConflict()};if(y.URITemplate&&typeof y.URITemplate.noConflict==="function"){q.URITemplate=y.URITemplate.noConflict()}if(y.IPv6&&typeof y.IPv6.noConflict==="function"){q.IPv6=y.IPv6.noConflict()}if(y.SecondLevelDomains&&typeof y.SecondLevelDomains.noConflict==="function"){q.SecondLevelDomains=y.SecondLevelDomains.noConflict()}return q}else{if(y.URI===this){y.URI=r}}return this};v.build=function(p){if(p===true){this._deferred_build=true}else{if(p===undefined||this._deferred_build){this._string=l.build(this._parts);this._deferred_build=false}}return this};v.clone=function(){return new l(this)};v.valueOf=v.toString=function(){return this.build(false)._string};function g(p){return function(q,D){if(q===undefined){return this._parts[p]||""}else{this._parts[p]=q||null;this.build(!D);return this}}}function d(p,q){return function(D,E){if(D===undefined){return this._parts[p]||""}else{if(D!==null){D=D+"";if(D.charAt(0)===q){D=D.substring(1)}}this._parts[p]=D;this.build(!E);return this}}}v.protocol=g("protocol");v.username=g("username");v.password=g("password");v.hostname=g("hostname");v.port=g("port");v.query=d("query","?");v.fragment=d("fragment","#");v.search=function(p,D){var q=this.query(p,D);return typeof q==="string"&&q.length?("?"+q):q};v.hash=function(p,D){var q=this.fragment(p,D);return typeof q==="string"&&q.length?("#"+q):q};v.pathname=function(p,D){if(p===undefined||p===true){var q=this._parts.path||(this._parts.hostname?"/":"");return p?(this._parts.urn?l.decodeUrnPath:l.decodePath)(q):q}else{if(this._parts.urn){this._parts.path=p?l.recodeUrnPath(p):""}else{this._parts.path=p?l.recodePath(p):"/"}this.build(!D);return this}};v.path=v.pathname;v.href=function(p,H){var D;if(p===undefined){return this.toString()}this._string="";this._parts=l._parts();var q=p instanceof l;var F=typeof p==="object"&&(p.hostname||p.path||p.pathname);if(p.nodeName){var E=l.getDomAttribute(p);p=p[E]||"";F=false}if(!q&&F&&p.pathname!==undefined){p=p.toString()}if(typeof p==="string"||p instanceof String){this._parts=l.parse(String(p),this._parts)}else{if(q||F){var G=q?p._parts:p;for(D in G){if(s.call(this._parts,D)){this._parts[D]=G[D]}}}else{throw new TypeError("invalid input")}}this.build(!H);return this};v.is=function(J){var G=false;var H=false;var F=false;var D=false;var q=false;var E=false;var I=false;var p=!this._parts.urn;if(this._parts.hostname){p=false;H=l.ip4_expression.test(this._parts.hostname);F=l.ip6_expression.test(this._parts.hostname);G=H||F;D=!G;q=D&&k&&k.has(this._parts.hostname);E=D&&l.idn_expression.test(this._parts.hostname);I=D&&l.punycode_expression.test(this._parts.hostname)}switch(J.toLowerCase()){case"relative":return p;case"absolute":return !p;case"domain":case"name":return D;case"sld":return q;case"ip":return G;case"ip4":case"ipv4":case"inet4":return H;case"ip6":case"ipv6":case"inet6":return F;case"idn":return E;case"url":return !this._parts.urn;case"urn":return !!this._parts.urn;case"punycode":return I}return null};var A=v.protocol;var a=v.port;var x=v.hostname;v.protocol=function(p,q){if(p!==undefined){if(p){p=p.replace(/:(\/\/)?$/,"");if(!p.match(l.protocol_expression)){throw new TypeError('Protocol "'+p+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]")}}}return A.call(this,p,q)};v.scheme=v.protocol;v.port=function(p,q){if(this._parts.urn){return p===undefined?"":this}if(p!==undefined){if(p===0){p=null}if(p){p+="";if(p.charAt(0)===":"){p=p.substring(1)}if(p.match(/[^0-9]/)){throw new TypeError('Port "'+p+'" contains characters other than [0-9]')}}}return a.call(this,p,q)};v.hostname=function(q,E){if(this._parts.urn){return q===undefined?"":this}if(q!==undefined){var p={};var D=l.parseHost(q,p);if(D!=="/"){throw new TypeError('Hostname "'+q+'" contains characters other than [A-Z0-9.-]')}q=p.hostname}return x.call(this,q,E)};v.origin=function(q,F){if(this._parts.urn){return q===undefined?"":this}if(q===undefined){var E=this.protocol();var D=this.authority();if(!D){return""}return(E?E+"://":"")+this.authority()}else{var p=l(q);this.protocol(p.protocol()).authority(p.authority()).build(!F);return this}};v.host=function(p,D){if(this._parts.urn){return p===undefined?"":this}if(p===undefined){return this._parts.hostname?l.buildHost(this._parts):""}else{var q=l.parseHost(p,this._parts);if(q!=="/"){throw new TypeError('Hostname "'+p+'" contains characters other than [A-Z0-9.-]')}this.build(!D);return this}};v.authority=function(p,D){if(this._parts.urn){return p===undefined?"":this}if(p===undefined){return this._parts.hostname?l.buildAuthority(this._parts):""}else{var q=l.parseAuthority(p,this._parts);if(q!=="/"){throw new TypeError('Hostname "'+p+'" contains characters other than [A-Z0-9.-]')}this.build(!D);return this}};v.userinfo=function(p,D){if(this._parts.urn){return p===undefined?"":this}if(p===undefined){var q=l.buildUserinfo(this._parts);return q?q.substring(0,q.length-1):q}else{if(p[p.length-1]!=="@"){p+="@"}l.parseUserinfo(p,this._parts);this.build(!D);return this}};v.resource=function(p,D){var q;if(p===undefined){return this.path()+this.search()+this.hash()}q=l.parse(p);this._parts.path=q.path;this._parts.query=q.query;this._parts.fragment=q.fragment;this.build(!D);return this};v.subdomain=function(q,G){if(this._parts.urn){return q===undefined?"":this}if(q===undefined){if(!this._parts.hostname||this.is("IP")){return""}var p=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,p)||""}else{var F=this._parts.hostname.length-this.domain().length;var E=this._parts.hostname.substring(0,F);var D=new RegExp("^"+f(E));if(q&&q.charAt(q.length-1)!=="."){q+="."}if(q){l.ensureValidHostname(q)}this._parts.hostname=this._parts.hostname.replace(D,q);this.build(!G);return this}};v.domain=function(q,F){if(this._parts.urn){return q===undefined?"":this}if(typeof q==="boolean"){F=q;q=undefined}if(q===undefined){if(!this._parts.hostname||this.is("IP")){return""}var E=this._parts.hostname.match(/\./g);if(E&&E.length<2){return this._parts.hostname}var p=this._parts.hostname.length-this.tld(F).length-1;p=this._parts.hostname.lastIndexOf(".",p-1)+1;return this._parts.hostname.substring(p)||""}else{if(!q){throw new TypeError("cannot set domain empty")}l.ensureValidHostname(q);if(!this._parts.hostname||this.is("IP")){this._parts.hostname=q}else{var D=new RegExp(f(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(D,q)}this.build(!F);return this}};v.tld=function(p,E){if(this._parts.urn){return p===undefined?"":this}if(typeof p==="boolean"){E=p;p=undefined}if(p===undefined){if(!this._parts.hostname||this.is("IP")){return""}var F=this._parts.hostname.lastIndexOf(".");var q=this._parts.hostname.substring(F+1);if(E!==true&&k&&k.list[q.toLowerCase()]){return k.get(this._parts.hostname)||q}return q}else{var D;if(!p){throw new TypeError("cannot set TLD empty")}else{if(p.match(/[^a-zA-Z0-9-]/)){if(k&&k.is(p)){D=new RegExp(f(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(D,p)}else{throw new TypeError('TLD "'+p+'" contains characters other than [A-Z0-9]')}}else{if(!this._parts.hostname||this.is("IP")){throw new ReferenceError("cannot set TLD on non-domain host")}else{D=new RegExp(f(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(D,p)}}}this.build(!E);return this}};v.directory=function(D,H){if(this._parts.urn){return D===undefined?"":this}if(D===undefined||D===true){if(!this._parts.path&&!this._parts.hostname){return""}if(this._parts.path==="/"){return"/"}var q=this._parts.path.length-this.filename().length-1;var F=this._parts.path.substring(0,q)||(this._parts.hostname?"/":"");return D?l.decodePath(F):F}else{var G=this._parts.path.length-this.filename().length;var p=this._parts.path.substring(0,G);var E=new RegExp("^"+f(p));if(!this.is("relative")){if(!D){D="/"}if(D.charAt(0)!=="/"){D="/"+D}}if(D&&D.charAt(D.length-1)!=="/"){D+="/"}D=l.recodePath(D);this._parts.path=this._parts.path.replace(E,D);this.build(!H);return this}};v.filename=function(q,F){if(this._parts.urn){return q===undefined?"":this}if(typeof q!=="string"){if(!this._parts.path||this._parts.path==="/"){return""}var G=this._parts.path.lastIndexOf("/");var E=this._parts.path.substring(G+1);return q?l.decodePathSegment(E):E}else{var p=false;if(q.charAt(0)==="/"){q=q.substring(1)}if(q.match(/\.?\//)){p=true}var D=new RegExp(f(this.filename())+"$");q=l.recodePath(q);this._parts.path=this._parts.path.replace(D,q);if(p){this.normalizePath(F)}else{this.build(!F)}return this}};v.suffix=function(q,H){if(this._parts.urn){return q===undefined?"":this}if(q===undefined||q===true){if(!this._parts.path||this._parts.path==="/"){return""}var p=this.filename();var I=p.lastIndexOf(".");var F,E;if(I===-1){return""}F=p.substring(I+1);E=(/^[a-z0-9%]+$/i).test(F)?F:"";return q?l.decodePathSegment(E):E}else{if(q.charAt(0)==="."){q=q.substring(1)}var G=this.suffix();var D;if(!G){if(!q){return this}this._parts.path+="."+l.recodePath(q)}else{if(!q){D=new RegExp(f("."+G)+"$")}else{D=new RegExp(f(G)+"$")}}if(D){q=l.recodePath(q);this._parts.path=this._parts.path.replace(D,q)}this.build(!H);return this}};v.segment=function(F,I,H){var D=this._parts.urn?":":"/";var J=this.path();var G=J.substring(0,1)==="/";var E=J.split(D);if(F!==undefined&&typeof F!=="number"){H=I;I=F;F=undefined}if(F!==undefined&&typeof F!=="number"){throw new Error('Bad segment "'+F+'", must be 0-based integer')}if(G){E.shift()}if(F<0){F=Math.max(E.length+F,0)}if(I===undefined){return F===undefined?E:E[F]}else{if(F===null||E[F]===undefined){if(o(I)){E=[];for(var q=0,p=I.length;q<p;q++){if(!I[q].length&&(!E.length||!E[E.length-1].length)){continue}if(E.length&&!E[E.length-1].length){E.pop()}E.push(u(I[q]))}}else{if(I||typeof I==="string"){I=u(I);if(E[E.length-1]===""){E[E.length-1]=I}else{E.push(I)}}}}else{if(I){E[F]=u(I)}else{E.splice(F,1)}}}if(G){E.unshift("")}return this.path(E.join(D),H)};v.segmentCoded=function(F,q,G){var D,E,p;if(typeof F!=="number"){G=q;q=F;F=undefined}if(q===undefined){D=this.segment(F,q,G);if(!o(D)){D=D!==undefined?l.decode(D):undefined}else{for(E=0,p=D.length;E<p;E++){D[E]=l.decode(D[E])}}return D}if(!o(q)){q=(typeof q==="string"||q instanceof String)?l.encode(q):q}else{for(E=0,p=q.length;E<p;E++){q[E]=l.encode(q[E])}}return this.segment(F,q,G)};var t=v.query;v.query=function(q,E){if(q===true){return l.parseQuery(this._parts.query,this._parts.escapeQuerySpace)}else{if(typeof q==="function"){var D=l.parseQuery(this._parts.query,this._parts.escapeQuerySpace);var p=q.call(this,D);this._parts.query=l.buildQuery(p||D,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!E);return this}else{if(q!==undefined&&typeof q!=="string"){this._parts.query=l.buildQuery(q,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!E);return this}else{return t.call(this,q,E)}}}};v.setQuery=function(p,E,F){var D=l.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof p==="string"||p instanceof String){D[p]=E!==undefined?E:null}else{if(typeof p==="object"){for(var q in p){if(s.call(p,q)){D[q]=p[q]}}}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}}this._parts.query=l.buildQuery(D,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof p!=="string"){F=E}this.build(!F);return this};v.addQuery=function(p,D,E){var q=l.parseQuery(this._parts.query,this._parts.escapeQuerySpace);l.addQuery(q,p,D===undefined?null:D);this._parts.query=l.buildQuery(q,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof p!=="string"){E=D}this.build(!E);return this};v.removeQuery=function(p,D,E){var q=l.parseQuery(this._parts.query,this._parts.escapeQuerySpace);l.removeQuery(q,p,D);this._parts.query=l.buildQuery(q,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof p!=="string"){E=D}this.build(!E);return this};v.hasQuery=function(p,E,D){var q=l.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return l.hasQuery(q,p,E,D)};v.setSearch=v.setQuery;v.addSearch=v.addQuery;v.removeSearch=v.removeQuery;v.hasSearch=v.hasQuery;v.normalize=function(){if(this._parts.urn){return this.normalizeProtocol(false).normalizePath(false).normalizeQuery(false).normalizeFragment(false).build()}return this.normalizeProtocol(false).normalizeHostname(false).normalizePort(false).normalizePath(false).normalizeQuery(false).normalizeFragment(false).build()};v.normalizeProtocol=function(p){if(typeof this._parts.protocol==="string"){this._parts.protocol=this._parts.protocol.toLowerCase();this.build(!p)}return this};v.normalizeHostname=function(p){if(this._parts.hostname){if(this.is("IDN")&&c){this._parts.hostname=c.toASCII(this._parts.hostname)}else{if(this.is("IPv6")&&e){this._parts.hostname=e.best(this._parts.hostname)}}this._parts.hostname=this._parts.hostname.toLowerCase();this.build(!p)}return this};v.normalizePort=function(p){if(typeof this._parts.protocol==="string"&&this._parts.port===l.defaultPorts[this._parts.protocol]){this._parts.port=null;this.build(!p)}return this};v.normalizePath=function(G){var E=this._parts.path;if(!E){return this}if(this._parts.urn){this._parts.path=l.recodeUrnPath(this._parts.path);this.build(!G);return this}if(this._parts.path==="/"){return this}E=l.recodePath(E);var D;var q="";var F,p;if(E.charAt(0)!=="/"){D=true;E="/"+E}if(E.slice(-3)==="/.."||E.slice(-2)==="/."){E+="/"}E=E.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/");if(D){q=E.substring(1).match(/^(\.\.\/)+/)||"";if(q){q=q[0]}}while(true){F=E.search(/\/\.\.(\/|$)/);if(F===-1){break}else{if(F===0){E=E.substring(3);continue}}p=E.substring(0,F).lastIndexOf("/");if(p===-1){p=F}E=E.substring(0,p)+E.substring(F+3)}if(D&&this.is("relative")){E=q+E.substring(1)}this._parts.path=E;this.build(!G);return this};v.normalizePathname=v.normalizePath;v.normalizeQuery=function(p){if(typeof this._parts.query==="string"){if(!this._parts.query.length){this._parts.query=null}else{this.query(l.parseQuery(this._parts.query,this._parts.escapeQuerySpace))}this.build(!p)}return this};v.normalizeFragment=function(p){if(!this._parts.fragment){this._parts.fragment=null;this.build(!p)}return this};v.normalizeSearch=v.normalizeQuery;v.normalizeHash=v.normalizeFragment;v.iso8859=function(){var p=l.encode;var q=l.decode;l.encode=escape;l.decode=decodeURIComponent;try{this.normalize()}finally{l.encode=p;l.decode=q}return this};v.unicode=function(){var p=l.encode;var q=l.decode;l.encode=w;l.decode=unescape;try{this.normalize()}finally{l.encode=p;l.decode=q}return this};v.readable=function(){var G=this.clone();G.username("").password("").normalize();var F="";if(G._parts.protocol){F+=G._parts.protocol+"://"}if(G._parts.hostname){if(G.is("punycode")&&c){F+=c.toUnicode(G._parts.hostname);if(G._parts.port){F+=":"+G._parts.port}}else{F+=G.host()}}if(G._parts.hostname&&G._parts.path&&G._parts.path.charAt(0)!=="/"){F+="/"}F+=G.path(true);if(G._parts.query){var I="";for(var E=0,D=G._parts.query.split("&"),p=D.length;E<p;E++){var H=(D[E]||"").split("=");I+="&"+l.decodeQuery(H[0],this._parts.escapeQuerySpace).replace(/&/g,"%26");if(H[1]!==undefined){I+="="+l.decodeQuery(H[1],this._parts.escapeQuerySpace).replace(/&/g,"%26")}}F+="?"+I.substring(1)}F+=l.decodeQuery(G.hash(),true);return F};v.absoluteTo=function(F){var q=this.clone();var E=["protocol","username","password","hostname","port"];var H,D,G;if(this._parts.urn){throw new Error("URNs do not have any generally defined hierarchical components")}if(!(F instanceof l)){F=new l(F)}if(!q._parts.protocol){q._parts.protocol=F._parts.protocol}if(this._parts.hostname){return q}for(D=0;(G=E[D]);D++){q._parts[G]=F._parts[G]}if(!q._parts.path){q._parts.path=F._parts.path;if(!q._parts.query){q._parts.query=F._parts.query}}else{if(q._parts.path.substring(-2)===".."){q._parts.path+="/"}if(q.path().charAt(0)!=="/"){H=F.directory();H=H?H:F.path().indexOf("/")===0?"/":"";q._parts.path=(H?(H+"/"):"")+q._parts.path;q.normalizePath()}}q.build();return q};v.relativeTo=function(H){var G=this.clone().normalize();var p,F,E,q,I;if(G._parts.urn){throw new Error("URNs do not have any generally defined hierarchical components")}H=new l(H).normalize();p=G._parts;F=H._parts;q=G.path();I=H.path();if(q.charAt(0)!=="/"){throw new Error("URI is already relative")}if(I.charAt(0)!=="/"){throw new Error("Cannot calculate a URI relative to another relative URI")}if(p.protocol===F.protocol){p.protocol=null}if(p.username!==F.username||p.password!==F.password){return G.build()}if(p.protocol!==null||p.username!==null||p.password!==null){return G.build()}if(p.hostname===F.hostname&&p.port===F.port){p.hostname=null;p.port=null}else{return G.build()}if(q===I){p.path="";return G.build()}E=l.commonPath(q,I);if(!E){return G.build()}var D=F.path.substring(E.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");p.path=(D+p.path.substring(E.length))||"./";return G.build()};v.equals=function(q){var D=this.clone();var J=new l(q);var E={};var p={};var G={};var F,I,H;D.normalize();J.normalize();if(D.toString()===J.toString()){return true}F=D.query();I=J.query();D.query("");J.query("");if(D.toString()!==J.toString()){return false}if(F.length!==I.length){return false}E=l.parseQuery(F,this._parts.escapeQuerySpace);p=l.parseQuery(I,this._parts.escapeQuerySpace);for(H in E){if(s.call(E,H)){if(!o(E[H])){if(E[H]!==p[H]){return false}}else{if(!j(E[H],p[H])){return false}}G[H]=true}}for(H in p){if(s.call(p,H)){if(!G[H]){return false}}}return true};v.duplicateQueryParameters=function(p){this._parts.duplicateQueryParameters=!!p;return this};v.escapeQuerySpace=function(p){this._parts.escapeQuerySpace=!!p;return this};return l}));