var TimeSeriesChart;var FinalTimeSeriesData;function GenerateFirstTimeSeriesChart(g){if(LayerSettings.CurrGridBoxId>0){RawTimeseriesData.ValueFinal=ProcessRawDataValue(RawTimeseriesData.Value);FinalTimeSeriesData=new Map();var j=[];var b=[];for(counter=0;counter<RawTimeseriesData.ValueFinal.length;counter++){var e=RawTimeseriesData.Date[counter];var d=RawTimeseriesData.ValueFinal[counter];j.push(e);b.push(d)}FinalTimeSeriesData.set(g,{Date:j,Value:b});var f=[];var i=FinalTimeSeriesData.get(g).Date.slice(0);i.unshift("Date");var a=FinalTimeSeriesData.get(g).Value.slice(0);var c=Levels.Level_ID.indexOf(g.toString());var h=Levels.Name[c];f.push(i);a.unshift(h);f.push(a);TimeSeriesChart=c3.generate({bindto:"#TimeSeriesChart",data:{x:"Date",columns:f,onclick:function(l,k){ChangeDate(RawTimeseriesData.Date[l.index],function(){LoadSphereData(LayerSettings)})}},axis:{x:{label:"Date",type:"timeseries",tick:{format:"%Y-%m"}},y:{label:"Temperature ("+LayerSettings.TemperatureSymbol+")"}},zoom:{enabled:true},transition:{duration:0}})}}function RemoveLevelFromTimeSeries(b){var c=Levels.Level_ID.indexOf(b.toString());var a=Levels.Name[c];TimeSeriesChart.load({unload:[a]})}function AddLevelsToTimeSeries(g){if(LayerSettings.CurrGridBoxId>0){if(!FinalTimeSeriesData.has(g)){RawTimeseriesData.ValueFinal=ProcessRawDataValue(RawTimeseriesData.Value);var i=[];var b=[];for(counter=0;counter<RawTimeseriesData.ValueFinal.length;counter++){var e=RawTimeseriesData.Date[counter];var d=RawTimeseriesData.ValueFinal[counter];i.push(e);b.push(d)}FinalTimeSeriesData.set(g,{Date:i,Value:b})}var f=[];var a=FinalTimeSeriesData.get(g).Value.slice(0);var c=Levels.Level_ID.indexOf(g.toString());var h=Levels.Name[c];a.unshift(h);f.push(a);TimeSeriesChart.load({columns:f})}}function createCsvFromTimeseriesData(){var b="data:text/csv;charset=utf-8,";b+="Level Name,Date,Value\n";if(FinalTimeSeriesData.size>0){FinalTimeSeriesData.forEach(function(g,h){var j=Levels.Level_ID.indexOf(h.toString());var d=Levels.Name[j];for(var e=0;e<g.Date.length;e++){var f=d+","+g.Date[e]+","+g.Value[e];b+=f+"\n"}},FinalTimeSeriesData);var c=encodeURI(b);var a=document.createElement("a");a.setAttribute("href",c);a.setAttribute("download",LayerSettings.DatabaseStore+"_Timeseries_Lat"+LayerSettings.CurrGridBoxLat+"_Lon"+LayerSettings.CurrGridBoxLon+".csv");a.click()}else{$("#dialogNoData").dialog("open")}};